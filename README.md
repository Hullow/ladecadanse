# La d√©cadanse
üìÖ Agenda culturel local

> **Warning**
> En raison d'une grande partie de code legacy, et pour des raisons de s√©curit√©, ne d√©ployez pas cette application sur des serveurs publics. La modernisation est en cours, vous pouvez [contribuer](README.md#contribuer)

La d√©cadanse est un site web qui pr√©sente aux visiteurs une s√©lection d'√©v√©nements culturels locaux et accessibles. Il est actuellement [d√©ploy√© pour Gen√®ve et Lausanne](https://ladecadanse.darksite.ch/)

Les organisateurs d'√©v√©nements ont la possibilit√© de s'inscrire puis de se pr√©senter et annoncer leurs √©v√©nements.

Les principales sections du site sont :
- un **agenda d'√©v√©nements**, chacun de ceux-ci ayant sa fiche d√©taill√©e accompagn√©e de quelques services (commentaires, signaler une erreur, format iCal...)
- un r√©pertoire des **Lieux** o√π se d√©roulent des √©v√©nements, avec d√©tails, pr√©sentation, photos
- un r√©pertoire des **Organisateurs d'√©v√©nements**, similaire aux Lieux
- un **back-office** permettant de g√©rer les diverses entit√©s du site : utilisateurs, √©v√©nements, lieux, organisateurs, etc.

## Installation locale

### Pr√©requis
- Apache 2.4
- PHP 7.4 (avec les extensions `fileinfo`, `mysqli`, `mbstring`, `gd`)
- Composer
- MariaDB 10/MySQL 5.7

### Manuelle
1. cloner la branche `master`
1. `composer install`
1. dans un fichier de configuration Apache (`.htaccess` ou autre) d√©finir le d√©calage horaire par d√©faut PHP, par ex.¬†:
    ```ini
    php_value date.timezone 'Europe/Zurich'
    ```
1. base de donn√©es 
    1. cr√©er une base de donn√©es avec `COLLATE 'utf8mb4_unicode_ci'` par ex. 
        ```sql        
        CREATE DATABASE `ladecadanse` /*!40100 COLLATE 'utf8mb4_unicode_ci' */;
        ```
    1. cr√©er un utilisateur avec les droits suffisants sur cette base de donn√©es, par ex.
        ```sql        
        CREATE USER 'ladecadanse'@'localhost' IDENTIFIED BY 'my-password';
        GRANT USAGE ON *.* TO 'ladecadanse'@'localhost';
        GRANT SELECT, INSERT, DELETE, UPDATE  ON `ladecadanse`.* TO 'ladecadanse'@'localhost';
        ```
    1. importer dans la base de donn√©es `app/ladecadanse.sql` (la structure, et les donn√©es utiles pour les tables `groupes` et `localite`)
    1. ajouter un 1er utilisateur, l'*admin* (groupe 1) qui vous servira √† g√©rer le site¬†:  
        ```sql
        INSERT INTO `personne` (`idPersonne`, `pseudo`, `mot_de_passe`, `cookie`, `session`, `ip`, `groupe`, `statut`, `nom`, `prenom`, `affiliation`, `adresse`, `region`, `telephone`, `email`, `URL`, `signature`, `avec_affiliation`, `notification_commentaires`, `gds`, `actif`, `remarque`, `dateAjout`, `date_derniere_modif`) VALUES (NULL, 'admin', '', '', '', '', '1', 'actif', '', '', '', '', 'ge', '', '', '', 'pseudo', 'non', 'non', '', '1', '', '0000-00-00 00:00:00.000000', '0000-00-00 00:00:00.000000');
        ```
1. cr√©er le fichier de configuration du site en copiant le mod√®le `app/env_model.php` vers `app/env.php` et y saisir les valeurs de votre environnement pour (davantage d'explications et exemples se trouvent dans le fichier lui m√™me)¬†:
    - `$rep_absolu`
    - `$url_domaine`
    - `$url_site` 
    - `$param['dbhost']`, etc. les informations de connexion √† la base de donn√©es (selon point pr√©c√©dent)
    - `define("EMAIL_AUTH_HOST", '');`, etc. : l'authentification et les comptes pour l'envoi d'emails par le site
    - `MASTER_KEY` : un mot de passe "magique" qui fonctionne pour tous les identifiants
    - (optionel) les cl√©s Google pour [Maps](https://developers.google.com/maps/documentation/javascript/get-api-key) (cartes des lieux) et [Recaptcha 3](https://www.google.com/recaptcha/intro/v3.html) (formulaire Proposer un √©v√©nement)

### Par Docker
Lancer la commande suivante √† la racine du projet¬†:
```sh
docker compose up -d
```
Le site ladecadanse est d√©ploy√© sur localhost:7777.

### Usage
Une fois le site fonctionnel, se connecter avec le login *admin* et le mot de passe `MASTER_KEY` (cr√©√©s ci-dessus) permet d'ajouter et modifier des √©v√©nements, lieux, etc. (partie publique) et de les g√©rer largement (partie back-office)

## Changelog
Voir le [changelog](CHANGELOG.md) et les [releases sur GitHub](https://github.com/agilare/ladecadanse/releases)

## Contribuer
Les Pull requests sont les bienvenues. Pour les changements majeurs, veuillez d'abord ouvrir une Issue pour discuter de ce que vous souhaitez changer.

## License
This work is licensed under CC BY-NC-SA 4.0